(window.webpackJsonp=window.webpackJsonp||[]).push([[476],{763:function(a,t,s){"use strict";s.r(t);var n=s(1),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"nginx-访问权限详讲"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-访问权限详讲"}},[a._v("#")]),a._v(" Nginx 访问权限详讲")]),a._v(" "),t("p",[a._v("上节课我们已经简单接触了 Nginx 访问简单用法，简单的知道了，deny 是禁止访问，allow 是允许访问。但 Nginx 的访问控制还是比较复杂的，我们这节课就详细介绍一下。")]),a._v(" "),t("h2",{attrs:{id:"指令优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指令优先级"}},[a._v("#")]),a._v(" 指令优先级")]),a._v(" "),t("p",[a._v("我们先来看一下代码：")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("     location "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            allow  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("45.76")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".202")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".231")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            deny   all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("上面的配置表示只允许"),t("code",[a._v("45.76.202.231")]),a._v("进行访问，其他的 IP 是禁止访问的。但是如果我们把"),t("code",[a._v("deny all")]),a._v("指令，移动到 "),t("code",[a._v("allow 45.76.202.231")]),a._v("之前，会发生什么那？会发现所有的 IP 都不允许访问了。"),t("strong",[a._v("这说明了一个问题：就是在同一个块下的两个权限指令，先出现的设置会覆盖后出现的设置（也就是谁先触发，谁起作用）")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"复杂访问控制权限匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复杂访问控制权限匹配"}},[a._v("#")]),a._v(" 复杂访问控制权限匹配")]),a._v(" "),t("p",[a._v("在工作中，访问权限的控制需求更加复杂，例如，对于网站下的 img（图片目录）是运行所有用户访问，但对于网站下的 admin 目录则只允许公司内部固定 IP 访问。这时候仅靠 deny 和 allow 这两个指令，是无法实现的。我们需要 location 块来完成相关的需求匹配。")]),a._v(" "),t("p",[a._v("上面的需求，配置代码如下：")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("img"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            allow all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            deny all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[t("code",[a._v("=")]),a._v("号代表精确匹配，使用了"),t("code",[a._v("=")]),a._v("后是根据其后的模式进行精确匹配。这个直接关系到我们网站的安全，一定要学会。")]),a._v(" "),t("h2",{attrs:{id:"使用正则表达式设置访问权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用正则表达式设置访问权限"}},[a._v("#")]),a._v(" 使用正则表达式设置访问权限")]),a._v(" "),t("p",[a._v("只有精确匹配有时是完不成我们的工作任务的，比如现在我们要禁止访问所有 php 的页面，php 的页面大多是后台的管理或者接口代码，所以为了安全我们经常要禁止所有用户访问，而只开放公司内部访问的。")]),a._v(" "),t("p",[a._v("代码如下：")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("     location "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("~")]),a._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("php$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            deny all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("这样我们再访问的时候就不能访问以 php 结尾的文件了。是不是让网站变的安全很多了那？")])])}),[],!1,null,null,null);t.default=e.exports}}]);